K3s, a new open source project which is a lightweight implementation of Kubernetes that is easy to install and can run on x86 and ARM infrastructure with only 512 MB of RAM required to run it. 

To install, upgrade, and deploy the lightweight Kubernetes distribution, k3s, across various architectures, including ARM. This Rancher training covers managing multiple clusters and deploying applications using k3d and k3os. Explore the versatile k3s for edge computing, IoT, and CI

It is geared towards teams that need to deploy applications quickly and reliably to resource-constrained environments. Some use cases for K3s are edge, Single Board Computers, IoT, and CI. Watch the introductory training on K3s to learn how to:

- Install and upgrade K3s
- Deploy K3s on ARM
- Manage multiple K3s clusters and deploy applications
- Using k3d on the desktop
- Using k3os to deliver a container operating system

To get started with K3s, visit: [https://K3s.io](https://www.youtube.com/redirect?event=video_description&redir_token=QUFFLUhqbU9sNUM3QmlXQ3VLZmtCSlp3MVlSZEN5cVhOd3xBQ3Jtc0tueTREQy1OejU5c250TDIxRHVsc2p5T2RBY1FXSDVodnBMV3pYQWtJQ1hHLUtubjdZT1NyVjVuRmFNQUlJbVliVTRxWFNoZzlBeW1NN2dBeklNbHZIX3pUUFZVVnM3dHU4anl5QnVPQkdlNFU4anZZUQ&q=https%3A%2F%2FK3s.io%2F&v=2LNxGVS81mE)

---

### Agenda:
- Overview of K3s
- Demo - Install and Upgrade K3s
- Demo - Deploy K3s in an ARM-based MCUs and Air-gapped devices
- Using K3d on the desktop
- Using K3os to deliver a ContainerOS
- Manage multiple K3s clusters and deploy applications in it. 

---

# 1) K3S Overview
### Introduction on K3S:
- A Lightweight Certified Kubernetes Distribution
- Built for Production Operations - CNCF Native
- 40 MB Compressed in size as a single Binary, Easy to install, half the memory, all in a binary of less than 100 MB. , uses 250 MB of Memory - will prove the same in the demo. 
	- It is small, it is a single binary, easy to transport over the wire
- Single Process with Integrated Kubernetes Master, Worker's - Kubelet and Containerd. 
- SQLite in addition/stead to etcd. Can use etcd, if needed.
- Runs on x 86_64, ARM64 and ARMv7. 
- OSS project.

##### **Great for:**
- Edge
- Homelab
- Internet of Things (IoT)
- Continuous Integration (CI)
- Development
- Single board computers (ARM)
- Air-gapped environments
- Embedded K8s
- Situations where a PhD in K8s Clusterology is infeasible

### What is K3s?
**K3s is a fully compliant Kubernetes distribution with the following enhancements:**
- Distributed as a single binary or minimal container image.
- Lightweight datastore based on sqlite3 as the default storage backend. etcd3, MySQL, and Postgres are also available.
- Wrapped in simple launcher that handles a lot of the complexity of TLS and options.
- Secure by default with reasonable defaults for lightweight environments.
- Operation of all Kubernetes control plane components is encapsulated in a single binary and process, allowing K3s to automate and manage complex cluster operations like distributing certificates.
- External dependencies have been minimized; the only requirements are a modern kernel and cgroup mounts.
- Packages the required dependencies for easy "batteries-included" cluster creation:
    - containerd / cri-dockerd container runtime (CRI)
    - Flannel Container Network Interface (CNI)
    - CoreDNS Cluster DNS
    - Traefik Ingress controller
    - ServiceLB Load-Balancer controller
    - Kube-router Network Policy controller
    - Local-path-provisioner Persistent Volume controller
    - Spegel distributed container image registry mirror
    - Host utilities (iptables, socat, etc)


---

### What makes K3s, K3s?
In the sense, `K3s` is a stripped off version of kubernetes down to core removing bloat overheads and such. What has been removed, what has been replaced with, what are all the batteries included in K3s?

To build K3s, unnecessary code has been removed and there are few enhancements made over here,

| Removed                                   | Added                                                              |
| ----------------------------------------- | ------------------------------------------------------------------ |
| Legacy and Non-Default Features           | Simplified Installation                                            |
| Alpha Features                            | SQLite3 support in addition/stead to etcd                          |
| In-tree Cloud Providers - given as Addons | TLS Management                                                     |
| In-tree Storage Drivers - given as Addons | Automatic Manifest and Helm Chart Management - good for Edge Cases |
| Custom CRI (no reliance on docker)        | containerd, CoreDNS, Flannel, Traefik Ingress (good for ARM)       |
Patch every two weeks. 


---

### How K3s works:

##### Architecture:
![[image.png]]

![{{ .Site.Title }}](https://k3s.io/img/how-it-works-k3s-revised.svg)

The above figure shows the difference between K3s server and K3s agent nodes. For more information, see the [architecture documentation.](https://docs.k3s.io/architecture)

---

### How K3s use cases:
- Edge Computing, Embedded Systems and similar areas - single device running containers for cron oriented use-cases for several cases. 
- IoT Devices and Gateways - Devices collecting and managing data, computing data, process those data locally and transport by pushing or pulling it via the gateways over the edge to the cloud or other endpoints - as a worker, as an agent and such.
- CI Environments - Allows for quick standup clusters, tears into bits of pieces in ease - will see that in brief while we refer K3D in brief, how dev can take advantage of such tooling. 
- Single-App Clusters - incase of deploying Single-app cluster and taking it to scale and on the edge - getting used in the Retails, warehousing environments and such. 

---

### Demo Time - Install and Upgrade K3S
##### Prerequisites:
- Architectures - Linux: 
	- x86_64
	- ARMv7
	- ARM64
- Basic systems:
	- 1 CPU Core
	- 512MB+ of RAM 
	- 2 GB+ in Storage
- Network Connection with `staticIPs` Registered in it. 

##### Actions:
- Install by version (olders)
	- K3s systemd method script install 
	- K3s systemd method script upgrade to latest or release candidate.
- Install the latest release
- Uninstall gracefully

## Get Started

1. **Download K3s - [latest release](https://github.com/k3s-io/k3s/releases/latest): x86_64, ARMv7, and ARM64 are supported**  
2. Run server

```sh
sudo k3s server 
# Kubeconfig is written to /etc/rancher/k3s/k3s.yaml

sudo k3s kubectl get node

# On a different node run the below command. 
# NODE_TOKEN comes from /var/lib/rancher/k3s/server/node-token on your server

sudo k3s agent --server https://myserver:6443 --token ${NODE_TOKEN}
```

### Demo: Bootstrapping a K3s Cluster:
#### Description
K3s installation script is a convenient way to install it as a service on `systemd` or `openrc` based systems. 

This script is available at [https://get.k3s.io](https://get.k3s.io/). To install K3s using this method, just run:

```sh
curl -sfL https://get.k3s.io | sh - 

# Check for Ready node, takes ~30 seconds 
sudo k3s kubectl get node 
```

> **After running this installation:**
> - The `K3s` service will be configured to automatically restart after node reboots or if the process crashes or is killed
> - Additional utilities will be installed, including
	- `kubectl`, 
	- `crictl`,
	- `ctr`,
	- `k3s-killall.sh`, and
	- `k3s-uninstall.sh`
> - A [kubeconfig](https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/) file will be written to `/etc/rancher/k3s/k3s.yaml` 
> and the `kubectl` installed by `K3s` will automatically use it.

 
A single-node server installation is a fully-functional Kubernetes cluster, including all the datastore, control-plane, kubelet, and container runtime components necessary to host workload pods. It is not necessary to add additional server or agents nodes, but you may want to do so to add additional capacity or redundancy to your cluster.
 
 To install additional agent nodes and add them to the cluster, run the installation script with the `K3S_URL` and `K3S_TOKEN` environment variables. Here is an example showing how to join an agent:
```sh
curl -sfL https://get.k3s.io | K3S_URL=https://myserver:6443 K3S_TOKEN=mynodetoken sh -
```

Setting the `K3S_URL` parameter causes the installer to configure K3s as an agent, instead of a server.  The K3s agent will register with the K3s server listening at the supplied URL. The value to use for `K3S_TOKEN` is stored at 
```sh
/var/lib/rancher/k3s/server/node-token
```
on your server node.

---

## Install Script:

Get a node:
```sh
uname -a
```

K3S Install Script:
```sh
curl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=v0.3.0 sh-
```

Verify:
```sh
kubectl version
k3s -v
```

##### Up;