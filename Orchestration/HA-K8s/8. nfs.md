### 1. **On NFS Server (`nfs222`)**
```
# /etc/exports: the access control list for filesystems which may be exported
#		to NFS clients.  See exports(5).
#
# Example for NFSv2 and NFSv3:
# /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)
#
# Example for NFSv4:
# /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)
# /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)
#
#...
/srv/nfs/k8s 192.168.0.0/24(rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000)

/var/nfs	192.168.0.0/24(rw,sync,no_subtree_check,no_root_squash)
/var/nfs/volumes        192.168.0.0/24(rw,sync,no_subtree_check,no_root_squash)
/srv/nfs/k8s	192.168.0.0/24(rw,sync,no_subtree_check,no_root_squash)

```

Create dir & reload
```
sudo mkdir -p /srv/nfs/k8s
sudo mkdir -p /var/nfs/volumes
sudo chown -R 1000:1000 /srv/nfs/k8s
sudo exportfs -ra
sudo systemctl reload nfs-kernel-server
```


### 2. All K8s nodes:
```
sudo apt update && sudo apt install -y nfs-common
```

### 3. **Deploy Dynamic Provisioner**
```
helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/
helm install nfs-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \
  --namespace nfs-provisioner \
  --create-namespace \
  --set nfs.server=192.168.0.222 \
  --set nfs.path=/srv/nfs/k8s \
  --set storageClass.defaultClass=true
```

### GitOps Integration

Directory:
```
k8s-gitops/
â””â”€â”€ infra/
    â””â”€â”€ nfs-provisioner/
        â”œâ”€â”€ Chart.yaml
        â”œâ”€â”€ values.yaml
        â””â”€â”€ kustomization.yaml
```

`values.yaml`
```
nfs:
  server: 192.168.0.222
  path: /srv/nfs/k8s
storageClass:
  defaultClass: true
  reclaimPolicy: Retain  # or Delete
```

> ğŸ”œ **When you need HA storage**: Migrate to **Longhorn** (replicated block storage) or **Rook/Ceph**.

Limitations of NFS (Know Before You Go)
Pros:
- Simple setup
- Works on-prem
- Low latency
Cons:
- âŒ No replication (single point of failure)
- âŒ Not suitable for production HA databases
- âŒ No snapshots/backups built-in

Summary:
- âœ… Install `nfs-common` on **all nodes**
- âœ… Export `/srv/nfs/k8s` with proper permissions
- âœ… Deploy `nfs-subdir-external-provisioner` via Helm
- âœ… Use `storageClassName: nfs-client` in PVCs

---

