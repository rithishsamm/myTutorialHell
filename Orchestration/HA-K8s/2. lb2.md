# Keepalived on **Backup LB (lb114)**

Edit:
```
sudo nano /etc/keepalived/keepalived.conf
```

Use:
```
[sudo] password for admin114: 
global_defs {
  script_user root
  enable_script_security
}

vrrp_script chk_haproxy {
  script "/usr/bin/killall -0 haproxy"
  interval 2
  weight -20
  fall 2
  rise 2
}

vrrp_instance VI_1 {
  state BACKUP
  interface enp0s3
  virtual_router_id 51
  priority 100
  advert_int 1

  authentication {
    auth_type PASS
    auth_pass kubevip123
  }

  virtual_ipaddress {
    192.168.0.111/24 dev enp0s3
  }

  track_script {
    chk_haproxy
  }
}
```

Restart:
```
sudo systemctl restart keepalived sudo systemctl enable keepalived
```

---


TEST - 192.168.0.111

From any machine:

```
watch -n1 "ping -c1 192.168.0.111"
```

Now stop HAProxy on **lb112**:

```
sudo systemctl stop haproxy
```

Expected:

- VIP should move to **lb114**
- ping continues without interruption

Check Keepalived logs if needed:
```
sudo journalctl -u keepalived -f
```

# Test Kubernetes API through VIP

From a control plane or worker node:
```
curl -k https://192.168.0.111:6443/healthz
```
Should return `ok`

If K8s already bootstrapped with API pointing to a node,  
you will later re-init/join using:
```
--control-plane-endpoint 192.168.0.111:6443
```

---
