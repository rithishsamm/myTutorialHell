

```cardlink
url: https://kubernetes.io/docs/concepts/workloads/pods/downward-api/#downwardapi-fieldRef
title: "fieldRef Downward API"
description: "There are two ways to expose Pod and container fields to a running container: environment variables, and as files that are populated by a special volume type. Together, these two ways of exposing Pod and container fields are called the downward API."
host: kubernetes.io
favicon: https://kubernetes.io/icons/favicon-64.png
image: https://kubernetes.io/images/kubernetes-open-graph.png
```
[FieldRef Downward API \| Kubernetes](https://kubernetes.io/docs/concepts/workloads/pods/downward-api/#downwardapi-fieldRef)

##### Under **`fieldRef`** (parameters for general POD level Components)
There are some Pod-level fields, you can provide them to a container either as an **environment variable** or using a **`downwardAPI` volume**. - provides POD specific information. 

##### General (env var + volume):
*can provide these parameters to a container either as an **environment variable** or using a **`downwardAPI` volume***
- **`metadata.name`** the pod's name
- **`metadata.namespace`** - the pod's [namespace](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces)
- **`metadata.uid`** - the pod's unique ID
- **`metadata.annotations['<KEY>']`** -  the value of the pod's [annotation](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations) named `<KEY>` (for example, `metadata.annotations['myannotation']`)
- **`metadata.labels['<KEY>']`** - the text value of the pod's [label](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels) named `<KEY>` (for example, `metadata.labels['mylabel']`) 

##### Environment variables only:
*available as **environment variables** but not as volume:*
- **`spec.serviceAccountName`** - the name of the pod's [service account](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/)
- **`spec.nodeName`** - the name of the [node](https://kubernetes.io/docs/concepts/architecture/nodes/) where the Pod is executing
- **`status.hostIP`** - the primary IP address of the node to which the Pod is assigned
- **`status.hostIPs`** - the IP addresses is a dual-stack version of `status.hostIP`, the first is always the same as `status.hostIP`.
- **`status.podIP`** - the pod's primary IP address (usually, its `IPv4` address)
- **`status.podIPs`** - the IP addresses is a dual-stack version of `status.podIP`, the first is always the same as `status.podIP`

### FieldRef brief:
Here, as we are using [DownwardAPI manifest](https://github.com/rithishsamm/myTutorialHell/blob/main/Orchestration/k8engineers.com/kubernetes_latest_manifest/Kubernetes/07-Storage/downwardapi_env.yaml[Fetching Data#m8ls](https://github.com/rithishsamm/myTutorialHell/blob/main/Orchestration/k8engineers.com/kubernetes_latest_manifest/Kubernetes/07-Storage/downwardapi_env.yaml)) ![[00.Section13-K8sStorage(Volumes)#**Will be using this `Deployment` object's manifest in order to tinker with `DownwardAPI` VolumeType.** -]]
###### FieldRef with env vars:
Here in this manifest, 
- This a one container POD on a `Deployment` object. 
- here in this container, runs a `while` loop for every ten seconds, 
- The loops echoes the **$PodIP** every 10 Seconds in the webpage located in `/var/log/index.html` to print in it and also in /proc/l/fd/1 to execute the same in the standard output too.  
THE CORE IS, 
>  HOW COME WE KNOW ABOUT THE **PodIP** AND TELL IT TO THE CONTAINER TO GET IT TO KNOW ABOUT THE `POD` 's IP. 
==For that, we use **DownwardAPI**. ==, In `DownwardAPI`, will pull the **PodIP** address using **ENVIRONMENT VARIABLES**. 
How to fetch the PodIP? - `FieldRef`

Will see how it works in action:

Create and verify `deployment` object:
```
kubectl create -f /path/to/downwardAPI.yaml
```
```
kubectl get deploy,rs,po -o wide 
```

Output?
```
kubectl logs podName1
kubectl logs podName2
kubectl logs podName3
```
 Prints its own **PodIP**, since it is a dynamic value which we couldn't be able to determined to execute what to run in  

Just like these `PodIP` we fetch multiple values as we seen in the above given **env vars**, This is what we do using `DownwardAPI`. 

**==SO, THIS IS HOW WE USE FieldRef `DownwardAPI` in env vars. 

NOW WILL SEE HOW TO USE THE SAME, resourceFieldRef `DownwardAPI` ==** - store information in env vars


##### Volumes only:
*available as **downwardAPI volume** but not as  environment variables :*
-  **`metadata.labels`** - all of the pod's labels, formatted as `label-key="escaped-label-value"` with one label per line
- **`metadata.annotations`** - all of the pod's annotations, formatted as `annotation-key="escaped-annotation-value"` with one annotation per line

###### FieldRef with volumes:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deploy
  labels:
    app: nginx
    environment: production
    
spec:
  replicas: 3
  selector:
    matchLabels:
      environment: production
      
  template:
    metadata:
      name: nginx-demo
      labels:
        app: nginx
        environment: production
        
    spec:
      containers:
      - name: write-container
        image: alpine
        command: ["/bin/sh"]
        args: ["-c", "while true; do echo \"Time: $(date +%r) POD_NAME: $(cat /var/log/index.html)\" > /proc/1/fd/1; sleep 10; done"]
        env:
          - name: POD_IP
            valueFrom:
              fieldRef:
                fieldPath: status.podIP

          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          # and more environment variables can be added here...

        volumeMounts:
          - name: shared-data
            mountPath: /var/log
      volumes:
        - name: shared-data
          downwardAPI:
            items:
              - path: "index.html"
                fieldRef:
                  fieldPath: metadata.name
              # - path: "status.podIP"
              #   fieldRef:
              #     fieldPath: status.podIP
```

Here, similar to the ENVIRONMENT VARIABLES, 

Create and verify `deployment` object:
```
kubectl create -f /path/to/downwardAPI.yaml
```
```
kubectl get deploy,rs,po -o wide 
```

Output?
```
kubectl logs podName1
kubectl logs podName2
kubectl logs podName3
```

Printing,
- **Time Parameter,**
- The string we passed,
- **The PodName**,
**==THIS IS HOW YOU DO, IF YOU WANT TO FETCH VARIABLES AND STORE SUCH FILES/DATA IN THE VOLUME - ==DownwardAPI with FieldRef Volumes====** - store information in VOLUMES.

---
