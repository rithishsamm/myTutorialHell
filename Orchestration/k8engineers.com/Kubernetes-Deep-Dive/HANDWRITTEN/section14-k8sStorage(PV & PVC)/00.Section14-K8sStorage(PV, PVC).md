##### Section 13: K8s Storage (PV, PVC)

Section 14: K8s Storage (PV & PVC)
1.  Introduction to Persistent Storage
	Introduction to Persistent Storage - [Doc]
2. Understanding Persistent Volume Access Modes
	Understanding Persistent Volume Access Modes - [Doc]
3.  `Static PV` and `PVC` (`volume plugin: hostPath`)
	Static `PV` and `PVC` (`volume plugin hostPath`) - [Doc]
4. `PV` and `PVC` management (`hostPath`)
	`PV` and `PVC` management (`hostPath`) - [Doc]
5. `Static PV` and `PVC` (`volume plugin: nfs`)
6. Persistent Volume Reclaim Policies (`nfs`: retain, recycle, delete)
7. Introduction to `AccessModes` for `PV` and `PVC`
	Introduction to `AccessModes` for `PV` and `PVC` - [Doc]
8. `AccessModes`
	AccessModes - [Doc]
9. Understanding `PV` phases
	Understanding `PV` phases - [Doc]
---

# Section 13: K8s Storage (PV, PVCs)
# 1. Introduction to Persistent Storage (PV, PVCs)
Introduction to Persistent Storage - [Doc]

So far, we have seen about `Volumes` and its `types` in brief on handling and storing data across K8s Clusters. And understood ==that if the POD gets deleted, also the data. The K8s doesn't have a way of chance having `APIs` to communicate with or the handle volumes in order to manage and administrate it in ease. 
And we have somehow mitigated the situation with `nfs` and such. But,==

###### **HOW DO WE AVOID SUCH CASE AND WHAT IS THE SOLUTION FOR IT ??** - **==Persistent Storage,
Under that, there are few types to it,
1) **Persistent Volume (PV)**
2) **Persistent Volume Claim (PVC)**
3) **Storage Class (sc)** 
4) **Volume Expansion** (advanced)
5) **Volume Snapshots** (advanced)

> **How does this `PersistentVolume` differs from `Volumes`?** 
Volumes gets deleted if the POD gets deleted (even in `nfs`, the volume gets deleted but not the data). Here, that is not the case with `PV`, The Volumes won't get deleted.

**==`PersistentVolume` is a whole separate object.==**. These `PVs` are not binded to the PODs. 
**Here, has some `APIs` that the K8s Clusters that can communicate to, to fetch information related to the storage. where we can able to handle, manage and administrate the storage volumes in ease.** 

So, tldr, even if the POD gets deleted, `PersistentVolume` `PVs` doesn't. here, there are 

###### PersistentVolume (`PV`) Core feature components:
1) **Provision Types:**
- Static
- Dynamic

2) **Access Modes:**
- ReadWriteOnce (`RWO`)
- ReadWriteMany (`RWX`)
- ReadOnlyMany (`ROX`)
- ReadWriteOncePod (`RWOP`)

3) **Binding**
- `PV` bind with `PVC`
- `PVC` bind with `PV` 
(both are Bi-directional)

4) **Reclaim Policy,**
- Retain
- Delete
- Recycle

###### PersistentVolume Claims (`PVC`) Core feature components:
Nothing but claim along with or to the `PV`, PV can be created either by an administrator (static PV)or by Storage Class (Dynamic PV).


##### Persistent Volume Solutions for `K8s`
- In order to provide `Volume` as Object, which is controlled through API by administrator for workloads (POD)
- `PersistentVolume` life cycle is `independent` to the POD workloads utilized by it. 
- Even  after deleting workloads (pod, deployment, daemonset etc.,) volume object should exist (persistent)
- `PersistentVolume` will be provisioned by Volumes are also supported in PV (most of them)
	- `hostPath, nfs, local, iSCSI` etc.
- `PresistentVolumeClaim` is a request from workloads to consume `PersistentVolume`.
- We can also create `dymanic PVC` as well under `StatefulSet` `sts`  Object with ` VolumeClaimTemplates `
- `PVC` requests `storage size` and `access modes` (RWO, RWX, ROX, RWOP)
- `PV` and `PVC` binding is `one-to-one` mapping (bi-directional)
- One `PVC` can be attached to multiple workloads (PODs)
- `AccessModes` are controlled by `kube-controller-manager` and `kubelet` only specified PODs are allowed to access `PV`.
- Storage Object use Protection will ensure, `PVC` gets deleted only if it is not actively used by any `POD` (workloads)
- `Persistent Volume` supports two modes: `FIlesystem` (default) and `Block` (RAW)
- `PV` is a **cluster level** object and `PVC` is **namespace level** Object. 

##### In order to provide `Volume` as Object, which is controlled through API by administrator for workloads (POD)
If there is POD with multiple containers, they share data in between those containers using a shared volume. As mentioned before, 



##### `PersistentVolume` life cycle is `independent` to the POD workloads utilized by it. 



##### Even  after deleting workloads (pod, deployment, daemonset etc.,) volume object should exist (persistent)



##### `PersistentVolume` will be provisioned by Volumes are also supported in PV (most of them)
	- `hostPath, nfs, local, iSCSI` etc.



##### `PresistentVolumeClaim` is a request from workloads to consume `PersistentVolume`. 



#####  We can also create `dymanic PVC` as well under `StatefulSet` `sts`  Object with ` VolumeClaimTemplates `



#####  `PVC` requests `storage size` and `access modes` (`RWO, RWX, ROX, RWOP`)



##### `PV` and `PVC` binding is `one-to-one` mapping (bi-directional)



##### One `PVC` can be attached to multiple workloads (PODs)



##### `AccessModes` are controlled by `kube-controller-manager` and `kubelet` only specified PODs are allowed to access `PV`.



##### Storage Object use Protection will ensure, `PVC` gets deleted only if it is not actively used by any `POD` (workloads)



##### `Persistent Volume` supports two modes: `Filesystem` (default) and `Block` (RAW)



##### `PV` is a **cluster level** object and `PVC` is **namespace level** Object. 



##### And there are Volume plugins:
**Volume plugins that supports Raw Block Volume.** 
- AWS EBS - Amazon Elastic Block Store 
- AzureDisk 
- CSI 
- FC (Fibre Channel)
- GCEPersistentDisk
- iSCSI
- Local Volume
- OpenStack Cinder 
- RBD (Ceph Block Device)
- VsphereVolume



---
# 2 . Understanding Persistent Volume Access Modes
Understanding Persistent Volume Access Modes - [Doc]

>  NOTE: When to use these access modes heavily depends on `Volume Plugin`, which means we can't use as per our need for anything and everything.

| Access Modes              | Description                                                                                                                                                   |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ReadWriteOnce (`RWO`)     | If we need to give Read and Write Permissions for the PODs running on single node. This mode is not suitable for PODs running on multiple nodes (`hostPath`). |
| ReadWriteMany (`RWX`)     | We need to enable if there is requirement to use storage by multiple `PODs` running on different nodes in the cluster (`NFS`)                                 |
| ReadOnlyMany (`ROX`)      | In order to give read-only access to `PODs` running on multiple nodes across the cluster, where write access should be blocked.                               |
| ReadWriteOncePod (`RWOP`) | In certain conditions, we need to give Read and Write to single `POD` running on single node (not all the `PODs` running on single node)                      |





--- 
# 3 .  Static PV and PVC (volume plugin: hostPath)
Static PV and PVC (volume plugin hostPath) - [Doc]

---
# 4 . PV and PVC management (hostPath)
PV and PVC management (hostPath) - [Doc]

---
# 5 . Static PV and PVC (volume plugin: nfs)


---
# 6 . Persistent Volume Reclaim Policies (nfs: retain, recycle, delete)



---
# 7 . Introduction to AccessModes for PV and PVC
Introduction to AccessModes for PV and PVC - [Doc]

---
# 8 . AccessModes
AccessModes - [Doc]


---

# 9 . Understanding PV phases
Understanding PV phases - [Doc]


---
